{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 700,
  "height": 500,
  "params": [
    {
      "name": "attribute_selection",
      "value": "Total Cases (per 100,000 population)",
      "bind": {
        "input": "select",
        "options": ["Total Cases (per 100,000 population)", "Total Deaths (per 100,000 population)"],
        "name": "Attribute: "
      }
    },
    {
      "name": "projection_selection",
      "value": "equalEarth",
      "bind": {
        "input": "select",
        "options": [
          "albers",
          "albersUsa",
          "azimuthalEqualArea",
          "azimuthalEquidistant",
          "conicConformal",
          "conicEqualArea",
          "conicEquidistant",
          "equalEarth",
          "equirectangular",
          "gnomonic",
          "mercator",
          "naturalEarth1",
          "orthographic",
          "stereographic",
          "transverseMercator"
        ],
        "name": "Projection: "
      }
    },
    {
      "name": "highlight",
      "select": {"type": "point", "on": "mouseover"}
    }
  ],
  "data": {
    "url": "https://raw.githubusercontent.com/nathanwsoe/Assignment-2/main/js/ne_110m_admin_0_countries.topojson",
    "format": {
          "type": "topojson",
          "feature": "ne_110m_admin_0_countries"
        }
  },
  "transform": [{
      "lookup": "properties.NAME",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/nathanwsoe/Assignment-2/main/data/cases_and_deaths_cleaned.csv"
        },
        "key": "location",
        "fields": [
          "continent", "total_cases",
          "total_cases_per_million", "total_deaths", "total_deaths_per_million", "population"
          ]
      }
    },
    {
      "filter": "datum.continent != null"
    },
    {
      "calculate": "datum.total_cases_per_million / 10",
      "as": "Total Cases (per 100,000 population)"
    },
    {
      "calculate": "datum.total_deaths_per_million / 10",
      "as": "Total Deaths (per 100,000 population)"
    },
    {"calculate": "datum[attribute_selection]", "as": "new_attribute"}
  ],
  "projection": {"type": {"expr": "projection_selection"}},
  "mark": 
  {
    "type": "geoshape",
    "stroke": "black"
  },
  "encoding": {
    "color": {
      "field": "new_attribute",
      "type": "quantitative",
      "scale": {
        "type": "quantile"
      },
      "title": "Attribute (per 100,000 population)"
    },
    "tooltip": [
      {"field": "properties.NAME", "type": "nominal", "title": "Country"},
      {"field": "continent", "type": "nominal", "title": "Continent"},
      {"field": "total_cases", "type": "quantitative", "title": "Total Cases", "format": ",.2f"},
      {"field": "Total Cases (per 100,000 population)", "type": "quantitative", "format": ",.2f"},
      {"field": "total_deaths", "type": "quantitative", "title": "Total Deaths", "format": ",.2f"},
      {"field": "Total Deaths (per 100,000 population)", "type": "quantitative", "format": ",.2f"}
    ],
    "strokeWidth": {
      "field": "new_attribute",
      "type": "quantitative",
      "scale": {
        "type": "quantile",
        "range": [1, 1, 1, 1]
      }
    },
    "strokeOpacity": {
    "condition": [
        {
          "param": "highlight",
          "empty": false,
          "value": 1
        }
      ],
      "value": 0.3
    }
  },
  "config": {
      "style": {
        "cell": {
          "stroke": null
        }
      },
      "background": "#eaf6ff",
      "legend": {"orient": "top-left", "offset": -18}
    }
}
